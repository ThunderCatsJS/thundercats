<!DOCTYPE html>

<html>
    <head>
        <title>ThunderCats.js</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
        <link rel="stylesheet" media="all" href="docs/docco.css" />
    </head>
    <body>
        <div id="container">
            <div id="background"></div>
            
            <ul class="sections">
                
                
                <li id="section-1">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-1">&#182;</a>
                        </div>
                        <p><a href="https://circleci.com/gh/r3dm/thundercats"><img src="https://circleci.com/gh/r3dm/thundercats.svg?style=svg" alt="Circle CI"></a>
<a href="https://coveralls.io/r/r3dm/thundercats"><img src="https://coveralls.io/repos/r3dm/thundercats/badge.svg" alt="Coverage Status"></a>
<a href="https://gemnasium.com/r3dm/thundercats"><img src="https://gemnasium.com/r3dm/thundercats.svg" alt="Dependency Status"></a>
<a href="https://npmjs.org/package/thundercats"><img src="http://img.shields.io/npm/v/thundercats.svg" alt="NPM version"></a>
<a href="https://codeclimate.com/github/r3dm/thundercats"><img src="https://codeclimate.com/github/r3dm/thundercats/badges/gpa.svg" alt="Code Climate"></a></p>
<p><a href="https://waffle.io/r3dm/thundercats"><img src="https://badge.waffle.io/r3dm/thundercats.png?label=ready&amp;title=Ready" alt="Stories in Ready"></a>
<a href="https://gitter.im/r3dm/thundercats?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Join the chat at https://gitter.im/r3dm/thundercats"></a>
<a href="http://inch-ci.org/github/r3dm/thundercats"><img src="http://inch-ci.org/github/r3dm/thundercats.svg?branch=master" alt="Inline docs"></a>
<a href="https://npmjs.org/package/thundercats"><img src="http://img.shields.io/npm/dm/thundercats.svg" alt="Downloads"></a></p>
<h1 id="thundercats-js">ThunderCats.js</h1>
<blockquote>
<p>Thundercats, Ho!</p>
</blockquote>
<p>A <a href="https://github.com/facebook/flux/">Flux</a> architecture implementation by
Thunderians based on <a href="https://github.com/Reactive-Extensions/RxJS">RxJS</a></p>
<p>The <a href="https://github.com/facebook/flux/">Flux</a> architecture allows you to think
of your application as an unidirectional flow of data, this module aims to
facilitate the use of
<a href="https://github.com/Reactive-Extensions/RxJS/blob/master/doc/api/core/observable.md">RxJS Observable</a>
as basis for defining the relations between the different entities composing
your application.</p>
<h2 id="install">Install</h2>
<pre><code>npm install thundercats
</code></pre><h2 id="development">Development</h2>
<h3 id="tests">Tests</h3>
<p>Please at unit tests for any new code. Tests are written using Mocha and Chai.
Tests now use JSDOM, which require the use of io.js. If you aren’t already using
io.js, seriously yall switch already. ThunderCats.js still works Node, just
testing requires io.js.</p>
<h3 id="docs">Docs</h3>
<p>There are two sections to documentation: the guide written directly in the
source and the API docs generated from Mocha test suites (in progress).</p>
<p>If you find a typo or would like to contribute to the docs, make your changes
and run <code>make</code> in the root directory using the command line. This requires
<a href="https://jashkenas.github.io/docco/">docco</a> <code>npm install -g docco</code>. Then submit
a pull request.</p>
<h3 id="lint">Lint</h3>
<p>run <code>npm run lint</code> before commit changes and verify that there are no errors.</p>
<p>I find it good practice to run <code>npm test</code> (test will also lint files) before
making any changes to verify that tests are already passing before making any
new changes.</p>
<h4 id="general-rules-to-follow">General rules to follow</h4>
<ul>
<li>Horizontal space is precious, vertical space is cheap and plentiful. Keep your
indenting sane and to a minimum.</li>
<li>Use named functions instead of anonymous functions assigned to variables.</li>
<li>For most cases, declare module.exports as a single object with each key a part
of the files api at the top, and the named functions underneath this section.</li>
</ul>
<h3 id="api">API</h3>
<p>The api is still new and can be malleable for the foreseeable future. If there
are features you would like to see please open a new issue for discussion.
For the most part I want this project to support server-side
rendering/isomorphic js. My first inclination is to get it working using
singletons, which presents data leakage challenges. I am sure we are up to that
challenge and can come up with a viable solution.</p>

                    </div>
                    
                </li>
                
                
                <li id="section-2">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-2">&#182;</a>
                        </div>
                        <h1 id="observable-state-mixin">Observable State Mixin</h1>
<p>For your components</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> Rx = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rx'</span>),
    utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils'</span>),
    invariant = <span class="hljs-built_in">require</span>(<span class="hljs-string">'invariant'</span>),
    isObservable = utils.isObservable,
    areObservable = utils.areObservable,
    stateSubscriptions = [];

<span class="hljs-keyword">var</span> ObservableStateMixin = {

  statics: {</pre></div></div>
                    
                </li>
                
                
                <li id="section-3">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-3">&#182;</a>
                        </div>
                        <p>Allows subscriptions for all components using this mixin
to be disposed using MyComponent.disposeAllSubscriptions().</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>    disposeAllSubscriptions: disposeAllSubscriptions
  },

  getInitialState: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> displayName =
      <span class="hljs-keyword">this</span>.constructor.displayName || <span class="hljs-keyword">this</span>.constructor.name || <span class="hljs-string">''</span>;

    invariant(
      <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.getObservable === <span class="hljs-string">'function'</span>,
      <span class="hljs-string">'%s should provide "getObservable" function'</span>,
      displayName
    );

    <span class="hljs-keyword">this</span>._observableState = <span class="hljs-keyword">this</span>.getObservable(<span class="hljs-keyword">this</span>.props);

    invariant(
      areObservable(<span class="hljs-keyword">this</span>._observableState) ||
        isObservable(<span class="hljs-keyword">this</span>._observableState),
      <span class="hljs-string">'"%s.getObservable" should return an Rx.Observable or an array of '</span> +
        <span class="hljs-string">'Rx.Observables, given : %s'</span>,
      displayName,
      <span class="hljs-keyword">this</span>._observableState
    );</pre></div></div>
                    
                </li>
                
                
                <li id="section-4">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-4">&#182;</a>
                        </div>
                        <p>getObservable can return an array of observables
ThunderCats will use Rx.Observable.merge to create a single
stream of data</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (areObservable(<span class="hljs-keyword">this</span>._observableState)) {
      <span class="hljs-keyword">this</span>._observableState = Rx.Observable.merge(<span class="hljs-keyword">this</span>._observableState);
    }

    <span class="hljs-keyword">var</span> initialState = <span class="hljs-literal">null</span>;</pre></div></div>
                    
                </li>
                
                
                <li id="section-5">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-5">&#182;</a>
                        </div>
                        <p>In getInitialState we only want to get the initial value without
subscribing, So we use the first filter here.
You cannot use async observable here with server-side rendering as
the subscription will hang around after the component has rendered with
initial state of null;</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._observableState.first().subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val)</span> </span>{
      invariant(
        <span class="hljs-keyword">typeof</span> val === <span class="hljs-string">'object'</span>,
        <span class="hljs-string">'The observable returned by \'%s.getObservable\' should publish '</span> +
          <span class="hljs-string">'objects or null given : %s'</span>,
        displayName,
        val
      );
      initialState = val;
    });

    <span class="hljs-keyword">return</span> initialState;
  },

  componentDidMount: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
                    
                </li>
                
                
                <li id="section-6">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-6">&#182;</a>
                        </div>
                        <p>Now that the component has mounted, we will use a long lived
the subscription</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._stateSubscription =
      <span class="hljs-keyword">this</span>._observableState.subscribe(<span class="hljs-keyword">this</span>._stateObserver);</pre></div></div>
                    
                </li>
                
                
                <li id="section-7">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-7">&#182;</a>
                        </div>
                        <p>we save all disposable subscriptions to an array so that they can
be disposed of using MyComp.disposeAllSubscriptions()</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>    stateSubscriptions.push(<span class="hljs-keyword">this</span>._stateSubscription);
  },

  componentWillUnmount: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
                    
                </li>
                
                
                <li id="section-8">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-8">&#182;</a>
                        </div>
                        <p>On unmount, the subscription to the observable state is disposed
and removed from the global subscription array</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._stateSubscription.dispose();
    <span class="hljs-keyword">var</span> index = stateSubscriptions.indexOf(<span class="hljs-keyword">this</span>._stateSubscription);
    stateSubscriptions.splice(index, <span class="hljs-number">1</span>);
  },</pre></div></div>
                    
                </li>
                
                
                <li id="section-9">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-9">&#182;</a>
                        </div>
                        <p>This is the observer that will watch the observable state.
TODO: make this into a proper Rx.Observable</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>  _stateObserver: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val)</span> </span>{
    <span class="hljs-keyword">var</span> displayName =
      <span class="hljs-keyword">this</span>.constructor.displayName || <span class="hljs-keyword">this</span>.constructor.name || <span class="hljs-string">''</span>;

    invariant(
      <span class="hljs-keyword">typeof</span> val === <span class="hljs-string">'object'</span>,
      <span class="hljs-string">'The observable returned by \'%s.getObservable\' should publish '</span> +
      <span class="hljs-string">'Objects or null given : %s'</span>,
      displayName,
      val
    );

    <span class="hljs-keyword">this</span>.setState(val);
  }
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-10">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-10">&#182;</a>
                        </div>
                        <p>Dispose of all the subscriptions created by this mixin.</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">disposeAllSubscriptions</span><span class="hljs-params">()</span> </span>{
  stateSubscriptions.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(subscription)</span> </span>{
    subscription.dispose();
  });
  stateSubscriptions = [];
}

<span class="hljs-built_in">module</span>.exports = ObservableStateMixin;</pre></div></div>
                    
                </li>
                
                
                <li id="section-11">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-11">&#182;</a>
                        </div>
                        <p>Original source from <a href="https://github.com/fdecampredon/rx-react">https://github.com/fdecampredon/rx-react</a></p>

                    </div>
                    
                </li>
                
                
                <li id="section-12">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-12">&#182;</a>
                        </div>
                        <h1 id="thundercats-action">ThunderCats Action</h1>
<p>A ThunderCats Action is an Observable that can be called like a function!</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Rx = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rx'</span>),
    invariant = <span class="hljs-built_in">require</span>(<span class="hljs-string">'invariant'</span>),
    assign = <span class="hljs-built_in">require</span>(<span class="hljs-string">'object.assign'</span>),
    areObservable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils'</span>).areObservable,
    slice = <span class="hljs-built_in">Array</span>.prototype.slice;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Action</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> actionDefs = <span class="hljs-keyword">this</span>.__getActionNames()
    .map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> </span>{
      <span class="hljs-keyword">return</span> {
        name: name,
        map: <span class="hljs-keyword">this</span>[name]
      };
    }.bind(<span class="hljs-keyword">this</span>));

  Action.createActions(actionDefs, <span class="hljs-keyword">this</span>);
}

Action.prototype.__getActionNames = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> ctx = <span class="hljs-keyword">this</span>;
  invariant(
    ctx <span class="hljs-keyword">instanceof</span> Action,
    <span class="hljs-string">'internal method `getActionNames` called outside of Actions instance'</span>
  );

  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.getOwnPropertyNames(ctx.constructor.prototype)
    .filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> </span>{
      <span class="hljs-keyword">return</span> name !== <span class="hljs-string">'constructor'</span> &amp;&amp;
        name.indexOf(<span class="hljs-string">'__'</span>) === -<span class="hljs-number">1</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> ctx[name] === <span class="hljs-string">'function'</span>;
    });
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-13">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-13">&#182;</a>
                        </div>
                        <h2 id="create">create</h2>
<p>Create a single action object</p>
<p>Takes a single function <code>map</code> as an argument which will be applied
to each payload fed to this action. You can think of this as an Action
creator in a traditional flux implementation</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Action.create = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(map)</span> </span>{
  <span class="hljs-keyword">var</span> observers = [];

  <span class="hljs-keyword">var</span> actionStart = <span class="hljs-keyword">new</span> Rx.Subject();
  <span class="hljs-keyword">var</span> actionEnd = <span class="hljs-keyword">new</span> Rx.Subject();

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">action</span><span class="hljs-params">(value)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> map === <span class="hljs-string">'function'</span>) {
      value = map(value);
    }

    actionStart.onNext(value);
    <span class="hljs-keyword">var</span> os = observers.slice(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = os.length; i &lt; len; i++) {
      os[i].onNext(value);
    }
    actionEnd.onNext();

    <span class="hljs-keyword">return</span> value;
  }

  assign(action, Rx.Observable.prototype, Rx.Subject.prototype);

  Rx.Observable.call(action, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(observer)</span> </span>{
    observers.push(observer);
    <span class="hljs-keyword">return</span> {
      dispose: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        observers.splice(observers.indexOf(observer), <span class="hljs-number">1</span>);
      }
    };
  });</pre></div></div>
                    
                </li>
                
                
                <li id="section-14">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-14">&#182;</a>
                        </div>
                        <h3 id="has-observers">Has Observers</h3>
<p>returns the current number of observers for this action</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>  action.hasObservers = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasObservers</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> observers.length &gt; <span class="hljs-number">0</span> ||
      actionStart.hasObservers() ||
      actionEnd.hasObservers();
  };</pre></div></div>
                    
                </li>
                
                
                <li id="section-15">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-15">&#182;</a>
                        </div>
                        <h3 id="wait-for">Wait For</h3>
<p>takes observables as arguments and will
wait for each observable to publish a new value
before notifying its observers.</p>
<p>NOTE: if any of the observables never publishes a new value
this observable will not either.</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>  action.waitFor = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(observables)</span> </span>{
    observables = slice.call(<span class="hljs-built_in">arguments</span>);

    invariant(
      areObservable(observables),
      <span class="hljs-string">'action.waitFor takes only observables as arguments'</span>
    );

    <span class="hljs-keyword">return</span> actionStart
      .flatMap(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value)</span> </span>{
        <span class="hljs-keyword">return</span> Rx.Observable.combineLatest(
          observables.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(observable)</span> </span>{
            observable = observable.publish();
            observable.connect();
            <span class="hljs-keyword">return</span> observable;
          }),
          <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> value;
          }
        );
      });
  };

  <span class="hljs-keyword">return</span> action;
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-16">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-16">&#182;</a>
                        </div>
                        <h2 id="create-actions">Create Actions</h2>
<p>helper function to create multiple Actions at once.
It can take a string which will create one Action,
an Array of strings,
or an Array of objects with the keys <code>name</code> and <code>map</code>.
This will return an object with action functions as methods</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Action.createActions = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(actions, ctx)</span> </span>{
  ctx = ctx || {};
  invariant(
    <span class="hljs-keyword">typeof</span> ctx === <span class="hljs-string">'object'</span>,
    <span class="hljs-string">'thisArg supplied to createActions must be an object but got %s'</span>,
    ctx
  );

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> actions === <span class="hljs-string">'string'</span>) {
    actions = [actions];
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(actions)) {
    actions.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ctx, action)</span> </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> action === <span class="hljs-string">'string'</span>) {
        ctx[action] = Action.create();
      } <span class="hljs-keyword">else</span> {
        invariant(
          <span class="hljs-keyword">typeof</span> action === <span class="hljs-string">'object'</span>,
          <span class="hljs-string">'createActions requires items in array to be either strings '</span> +
          <span class="hljs-string">'or objects but was supplied with %s'</span>,
          action
        );

        invariant(
          <span class="hljs-keyword">typeof</span> action.name === <span class="hljs-string">'string'</span>,
          <span class="hljs-string">'createActions requires objects to have a name key, but got %s'</span>,
          action.name
        );

        <span class="hljs-keyword">if</span> (action.map) {
          invariant(
            <span class="hljs-keyword">typeof</span> action.map === <span class="hljs-string">'function'</span>,
            <span class="hljs-string">'createActions requires objects with map field to be a function '</span> +
            <span class="hljs-string">'but was given %s'</span>,
            action.map
          );
        }

        ctx[action.name] = Action.create(action.map);
      }
      <span class="hljs-keyword">return</span> ctx;
    }, ctx);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(
      <span class="hljs-string">'Action.createActions expects a string or an array but got %s'</span>,
      actions
    );
  }

  <span class="hljs-keyword">return</span> ctx;
};

<span class="hljs-built_in">module</span>.exports = Action;</pre></div></div>
                    
                </li>
                
                
                <li id="section-17">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-17">&#182;</a>
                        </div>
                        <h1 id="set-state-utility">Set State utility</h1>
<p>A helper function to pass as an argument to Rx.Observable.map;
If your Observable passes an object, this will assign the properties of
that object to the current value held in the store.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> newMappedObservable = someAction
  .map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(newData)</span> </span>{
    <span class="hljs-keyword">return</span> { <span class="hljs-string">'someCoolKey'</span>: newData };
  })
  .map(setStateUtil);
</code></pre>
<p>now this <code>newMappedObservable</code> can be passed into your Thundercats
<code>Stores.getOperations</code> spec definition</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> invariant = <span class="hljs-built_in">require</span>(<span class="hljs-string">'invariant'</span>),
    assign = <span class="hljs-built_in">Object</span>.assign || <span class="hljs-built_in">require</span>(<span class="hljs-string">'object.assign'</span>);

<span class="hljs-built_in">module</span>.exports = setStateUtil;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setStateUtil</span><span class="hljs-params">(newStateToSet)</span> </span>{
  invariant(
    newStateToSet || <span class="hljs-keyword">typeof</span> newStateToSet === <span class="hljs-string">'object'</span>,
    <span class="hljs-string">'setStateUtil expects an object, but got %s'</span>,
    newStateToSet
  );
  <span class="hljs-keyword">return</span> {
    transform: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(oldState)</span> </span>{
      <span class="hljs-keyword">var</span> newState = {};
      assign(newState, oldState, newStateToSet);
      <span class="hljs-keyword">return</span> newState;
    }
  };
}</pre></div></div>
                    
                </li>
                
                
                <li id="section-18">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-18">&#182;</a>
                        </div>
                        <h1 id="store">Store</h1>
<p>A Thundercats Store is an observable. It can update itself
according to observables it listens to passed in through
the <code>getOperations</code> method</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Rx = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rx'</span>),
    uuid = <span class="hljs-built_in">require</span>(<span class="hljs-string">'node-uuid'</span>),
    <span class="hljs-comment">/* eslint-disable no-native-reassign */</span>
    Map = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es6-map'</span>),
    <span class="hljs-comment">/* eslint-enable no-native-reassign */</span>
    invariant = <span class="hljs-built_in">require</span>(<span class="hljs-string">'invariant'</span>),
    utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils'</span>),
    inherits = utils.inherits,
    isPromise = utils.isPromise,
    isObservable = utils.isObservable,
    areObservable = utils.areObservable;</pre></div></div>
                    
                </li>
                
                
                <li id="section-19">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-19">&#182;</a>
                        </div>
                        <h2 id="create">Create</h2>
<p>Takes a spec object and returns an Rx Observable Thundercats store</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Store</span><span class="hljs-params">()</span> </span>{
  Rx.Observable.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>._subscribe);

  <span class="hljs-keyword">this</span>._value = {};
  <span class="hljs-keyword">this</span>._valueSubscription = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>._operationsSubscription = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>._observers = <span class="hljs-keyword">new</span> Map();
  <span class="hljs-keyword">this</span>._history = <span class="hljs-keyword">new</span> Map();
  <span class="hljs-keyword">this</span>._isPending = <span class="hljs-literal">true</span>;
}

inherits(Store, Rx.Observable);</pre></div></div>
                    
                </li>
                
                
                <li id="section-20">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-20">&#182;</a>
                        </div>
                        <h3 id="has-observers">Has Observers</h3>
<p>returns the number of observers watching this store</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype.hasObservers = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> !!<span class="hljs-keyword">this</span>._observers.size;
};

Store.prototype.getInitialValue = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'ThunderCats store getInitialValue not implemented'</span>);
};

Store.prototype.getOperations = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'ThunderCats Store getOperations not implemented'</span>);
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-21">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-21">&#182;</a>
                        </div>
                        <h3 id="init">init</h3>
<p>On first subscription, this function is called to set the initial value
of the store. The <code>getInitialValue</code> method can return a promise,
observable or a plain JavaScript object.</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> initialValue = <span class="hljs-keyword">this</span>.getInitialValue();
  <span class="hljs-keyword">if</span> (isPromise(initialValue)) {
    initialValue.then(
      <span class="hljs-keyword">this</span>._setValue.bind(<span class="hljs-keyword">this</span>),
      <span class="hljs-keyword">this</span>._notifyObservers.bind(<span class="hljs-keyword">this</span>)
    );
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isObservable(initialValue)) {
    <span class="hljs-keyword">this</span>._valueSubscription =
      initialValue.subscribe(
        <span class="hljs-keyword">this</span>._setValue.bind(<span class="hljs-keyword">this</span>),
        <span class="hljs-keyword">this</span>._notifyObservers.bind(<span class="hljs-keyword">this</span>)
      );
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>._setValue(initialValue);
  }
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-22">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-22">&#182;</a>
                        </div>
                        <h3 id="set-value">Set Value</h3>
<p>overrides the current value held by the store</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._setValue = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(val)</span> </span>{
  <span class="hljs-keyword">this</span>._value = val;
  <span class="hljs-keyword">this</span>._isPending = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">this</span>._initOperations();
  <span class="hljs-keyword">this</span>._notifyObservers();
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-23">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-23">&#182;</a>
                        </div>
                        <h3 id="notifyobservers">NotifyObservers</h3>
<p>sends the current value held by the store to its observers</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._notifyObservers = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span> </span>{
  <span class="hljs-keyword">this</span>._observers.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(observer)</span> </span>{
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> observer.onError(error);
    }
    observer.onNext(<span class="hljs-keyword">this</span>._value);
  }, <span class="hljs-keyword">this</span>);
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-24">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-24">&#182;</a>
                        </div>
                        <h3 id="initoperations">initOperations</h3>
<p>gets the observable passed in through getOperations and subscribes the
store to it’s changes</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._initOperations = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">this</span>._disposeOperations();

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.getOperations) {
    <span class="hljs-keyword">var</span> operations = <span class="hljs-keyword">this</span>.getOperations();

    invariant(
      areObservable(operations) ||
        isObservable(operations),
      <span class="hljs-string">'"%s.getObservable" should return an Rx.Observable or an array of '</span> +
      <span class="hljs-string">'Rx.Observables, given : %s'</span>,
      <span class="hljs-string">'ThunderCats Store'</span>,
      operations
    );

    <span class="hljs-keyword">if</span> (areObservable(operations)) {
      operations = Rx.Observable.merge(operations);
    }

    <span class="hljs-keyword">this</span>._operationsSubscription =
      operations.subscribe(
        <span class="hljs-keyword">this</span>._opsOnNext.bind(<span class="hljs-keyword">this</span>),
        <span class="hljs-keyword">this</span>.opsOnError.bind(<span class="hljs-keyword">this</span>),
        <span class="hljs-keyword">this</span>.opsOnCompleted.bind(<span class="hljs-keyword">this</span>)
    );
  }
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-25">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-25">&#182;</a>
                        </div>
                        <h3 id="applyoperation">applyOperation</h3>
<p>If an operation returns a proper object, this method is called.
It checks to see if a property <code>value</code> exists and returns that, else
it applies the <code>transform</code> method of the operation on the current value
held by the store.</p>
<p>NOTE: If <code>value</code> property is supplied, then the <code>transform</code> method is
simply ignored</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._applyOperation = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, operation)</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'value'</span> <span class="hljs-keyword">in</span> operation ?
    operation.value :
    operation.transform(value);
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-26">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-26">&#182;</a>
                        </div>
                        <h3 id="operation-observer">Operation Observer</h3>
<p>This is the observer that observes the stores operation observable
operations must return an object with at least the property <code>value</code>
or a method <code>transform</code>. It may also have the additional property <code>confirm</code>
which must be a promise. This is used to undo the value held by the store</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._opsOnNext = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(operation)</span> </span>{
  invariant(
    operation &amp;&amp; <span class="hljs-keyword">typeof</span> operation === <span class="hljs-string">'object'</span>,
    <span class="hljs-string">'invalid operation, operations should be an object, given : %s'</span>, operation
  );

  invariant(
    operation.value ||
    (
      operation.transform &amp;&amp;
      <span class="hljs-keyword">typeof</span> operation.transform === <span class="hljs-string">'function'</span>
    ),
    <span class="hljs-string">'invalid operation, '</span> +
    <span class="hljs-string">'operations should have a value or a transform property'</span>
  );

  <span class="hljs-keyword">var</span> oldValue = <span class="hljs-keyword">this</span>._value;
  <span class="hljs-keyword">this</span>._value = <span class="hljs-keyword">this</span>._applyOperation(<span class="hljs-keyword">this</span>._value, operation);
  <span class="hljs-keyword">this</span>._notifyObservers();

  <span class="hljs-keyword">var</span> uid = uuid.v1();

  <span class="hljs-keyword">this</span>._history.set(uid, {
    operation: operation,
    oldValue: oldValue
  });

  <span class="hljs-keyword">if</span> (<span class="hljs-string">'confirm'</span> <span class="hljs-keyword">in</span> operation) {
    invariant(
      isPromise(operation.confirm),
      <span class="hljs-string">'invalid operation, confirm should be a promise, given : %s'</span>,
      operation.confirm
    );

    operation.confirm.then(
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>._confirmOperation(uid);
      }.bind(<span class="hljs-keyword">this</span>),
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">this</span>._cancelOperation(uid);
      }.bind(<span class="hljs-keyword">this</span>)
    );

  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>._confirmOperation(uid);
  }
};

Store.prototype.opsOnError = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> </span>{
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'An error has occurred in the operations observer: '</span> + err);
};

Store.prototype.opsOnCompleted = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">'operations observable has terminated without error'</span>);
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-27">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-27">&#182;</a>
                        </div>
                        <h3 id="confirm-operation">Confirm Operation</h3>
<p>This method activates when the promise tied to an operation is resolved.</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._confirmOperation = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(uid)</span> </span>{
  <span class="hljs-keyword">this</span>._checkId(uid);
  <span class="hljs-keyword">this</span>._history.get(uid).confirmed = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">this</span>._history.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(operation, uid)</span> </span>{
    <span class="hljs-comment">/* istanbul ignore else */</span>
    <span class="hljs-keyword">if</span> (operation.confirmed) {
      <span class="hljs-keyword">this</span>._history.delete(uid);
    }
  }, <span class="hljs-keyword">this</span>);
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-28">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-28">&#182;</a>
                        </div>
                        <h3 id="cancel-operations">Cancel Operations</h3>
<p>If the promise in <code>confirm</code> is rejected, this method reverts the changes
made by the operation tied to this promise.</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._cancelOperation = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(uid)</span> </span>{
  <span class="hljs-keyword">this</span>._checkId(uid);
  <span class="hljs-keyword">var</span> _history = <span class="hljs-keyword">this</span>._history;</pre></div></div>
                    
                </li>
                
                
                <li id="section-29">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-29">&#182;</a>
                        </div>
                        <p>initial value</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> value = _history.get(uid).oldValue;
  <span class="hljs-keyword">var</span> found = <span class="hljs-literal">false</span>;
  _history.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(descriptor, _uid)</span> </span>{
    <span class="hljs-keyword">if</span> (uid === _uid) {
      found = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">if</span> (!found) {
      <span class="hljs-keyword">return</span>;
    }
    descriptor.oldValue = value;
    value = <span class="hljs-keyword">this</span>._applyOperation(value, descriptor.operation);
  }, <span class="hljs-keyword">this</span>);

  <span class="hljs-keyword">this</span>._value = value;
  _history.delete(uid);
  <span class="hljs-keyword">this</span>._notifyObservers();
};

Store.prototype._checkId = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> </span>{
  invariant(
    <span class="hljs-keyword">this</span>._history.has(id),
    <span class="hljs-string">'an unknown operation id was used that is not within its history.'</span> +
    <span class="hljs-string">'it may have been called outside of context'</span>
  );
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-30">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-30">&#182;</a>
                        </div>
                        <h3 id="dispose">dispose</h3>
<p>Disposes the subscription to initial value observable if any
and calls <code>disposeOperations</code></p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._dispose = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">/* istanbul ignore else */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._valueSubscription) {
    <span class="hljs-keyword">this</span>._valueSubscription.dispose();
  }
  <span class="hljs-keyword">this</span>._disposeOperations();
  <span class="hljs-keyword">this</span>._value = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>._valueSubscription = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>._isPending = <span class="hljs-literal">true</span>;
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-31">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-31">&#182;</a>
                        </div>
                        <h3 id="disposeoperations">disposeOperations</h3>
<p>Disposes all the stores current subscriptions
and clear operations history</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._disposeOperations = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._operationsSubscription) {
    <span class="hljs-keyword">this</span>._operationsSubscription.dispose();
  }

  <span class="hljs-keyword">this</span>._operationsSubscription = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>._history.clear();
};</pre></div></div>
                    
                </li>
                
                
                <li id="section-32">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-32">&#182;</a>
                        </div>
                        <h3 id="subscribe">Subscribe</h3>
<p>This is the main entry for observers of this <strong>ThunderCats</strong> Store
This method will track all observers and initiate the store.</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre>Store.prototype._subscribe = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(observer)</span> </span>{

  <span class="hljs-keyword">var</span> uid = uuid.v1();

  <span class="hljs-comment">/* istanbul ignore else */</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.hasObservers()) {
    <span class="hljs-keyword">this</span>._init();
  }

  <span class="hljs-keyword">this</span>._observers.set(uid, observer);

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._isPending) {
    observer.onNext(<span class="hljs-keyword">this</span>._value);
  }

  <span class="hljs-keyword">return</span> Rx.Disposable.create(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>._observers.delete(uid);
    <span class="hljs-comment">/* istanbul ignore else */</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.hasObservers()) {
      <span class="hljs-keyword">this</span>._dispose();
    }
  }.bind(<span class="hljs-keyword">this</span>));
};

Store.create = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(spec)</span> </span>{
  <span class="hljs-keyword">var</span> name = spec &amp;&amp; <span class="hljs-keyword">typeof</span> spec.name === <span class="hljs-string">'string'</span> ? spec.name : <span class="hljs-string">'Betty'</span>;

  invariant(
    spec &amp;&amp; <span class="hljs-keyword">typeof</span> spec === <span class="hljs-string">'object'</span>,
    <span class="hljs-string">'ThunderCats Store %s expects an object as argument, given %s'</span>,
    name,
    spec
  );

  invariant(
    spec.getInitialValue &amp;&amp; <span class="hljs-keyword">typeof</span> spec.getInitialValue === <span class="hljs-string">'function'</span>,
    <span class="hljs-string">'ThunderCats Store %s: getInitialValue should be a function given %s'</span>,
    name,
    spec.getInitialValue
  );

  invariant(
    !spec.getOperations || <span class="hljs-keyword">typeof</span> spec.getOperations === <span class="hljs-string">'function'</span>,
    <span class="hljs-string">'ThunderCats Store %s: getOperations should be a function given %s'</span>,
    name,
    spec.getOperations
  );

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ThunderCatsStore</span><span class="hljs-params">()</span> </span>{
    Store.call(<span class="hljs-keyword">this</span>);
  }

  inherits(ThunderCatsStore, Store);

  <span class="hljs-keyword">var</span> getInitialValue = spec.getInitialValue;
  <span class="hljs-keyword">var</span> getOperations = spec.getOperations ? spec.getOperations : <span class="hljs-literal">null</span>;

  ThunderCatsStore.prototype.name = name;
  ThunderCatsStore.prototype.getInitialValue = getInitialValue;
  ThunderCatsStore.prototype.getOperations = getOperations;

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThunderCatsStore();
};

<span class="hljs-built_in">module</span>.exports = Store;</pre></div></div>
                    
                </li>
                
                
                <li id="section-33">
                    <div class="annotation">
                        
                        <div class="pilwrap ">
                            <a class="pilcrow" href="#section-33">&#182;</a>
                        </div>
                        <h1 id="wait-for-utility">Wait For Utility</h1>
<p>Takes observables for arguments,
converts them to hot observables
then waits for each one to publish a value</p>
<p>It can also take an optional timeout (milliseconds)
as the first argument. By default this timeout is 3 seconds.</p>
<p>If the timeout is exceeded, the observers will be notified
on the onError observer. If no onError observer is supplied
the timeout throws the Error</p>
<p>returns an observable.</p>
<p><em>Note:</em> it’s good practice to use a firstOrDefault
observable if you just want a short lived subscription</p>

                    </div>
                    
                    <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Rx = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rx'</span>),
    utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../utils'</span>),
    invariant = <span class="hljs-built_in">require</span>(<span class="hljs-string">'invariant'</span>),
    areObservable = utils.areObservable,
    debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'thundercats:waitFor'</span>);

<span class="hljs-built_in">module</span>.exports = waitFor;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waitFor</span><span class="hljs-params">(timeout, observables)</span> </span>{
  observables = [].slice.call(<span class="hljs-built_in">arguments</span>);
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> timeout === <span class="hljs-string">'number'</span>) {
    observables = observables.slice(<span class="hljs-number">1</span>);
  } <span class="hljs-keyword">else</span> {
    timeout = <span class="hljs-number">3000</span>;
  }
  invariant(
    areObservable(observables),
    <span class="hljs-string">'waitFor takes only observables with optional number as the '</span> +
      <span class="hljs-string">'first agruments'</span>
  );
  debug(<span class="hljs-string">'setting waitFor with timeout %s'</span>, timeout);
  <span class="hljs-keyword">return</span> Rx.Observable.combineLatest(
    observables.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obs)</span> </span>{
      <span class="hljs-keyword">var</span> published = obs.publish();
      published.connect();
      <span class="hljs-keyword">return</span> published;
    }),
    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(values)</span> </span>{
      values = [].slice.call(<span class="hljs-built_in">arguments</span>);
      debug(<span class="hljs-string">'waitFor complete'</span>);
      <span class="hljs-keyword">return</span> values;
    }
  ).timeout(timeout);
}</pre></div></div>
                    
                </li>
                
            </ul>
        </div>
    </body>
</html>
